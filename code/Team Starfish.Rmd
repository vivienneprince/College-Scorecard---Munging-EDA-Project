---
title: "Team Starfish"
output: 
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '3'
    toc_float: yes
---


```{r, eval=TRUE, include=FALSE}

# devtools::install_github("wmurphyrd/fiftystater")
library(tidyverse)
library(ggplot2)
library(plotly)
library(sf)
library(googlesheets4)
library(fiftystater)

# getwd()
project.dir <- "Homework/Project 1 - College Scoreboard"
dataset.dir <- "Data"
outputs.dir <- "Output"
# setwd(file.path(getwd(), project.dir))
```
   
    
# Import data
```{r}
# Import raw data
raw.df <- read.csv(file = file.path(dataset.dir, "starfishdf.csv"))

# Import field variables
gs4_deauth()
starfish.fields <- read_sheet('https://docs.google.com/spreadsheets/d/1PL5zn6QLU9GSSD8rRreL8r7xaoClrPIrf5qnioZ3eE4/edit?usp=sharing')
```
     
  
# Data Quality   
##### Data Quality Check Function   
This is our function for checking the completeness and free-of-error dimensions of data quality as described by Pipino, Lee, and Wang.   

For completeness, we calculated the ratio of non-na values within each column. So a value of 1 would signify there are no na's in that column.   

For free-of-error, we returned the ratio of outliers within each numeric column. If the column is not numeric, it shows 'not numeric'. Outliers are by default defined as 3IQR less than the 1st quartile, or 3IQR more than the 3rd quartile. The IQR multiplier can be user specified by adding the argument 'criterion= x' where x is the desired multiplier to the function call. So a value of 0 would signify there are no outliers based on the criteria specified.    

```{r}
qualitycheck <- function(df, critereon=3) { 

  # setup
  col_count <- ncol(df)
  
  # return table setup
  returntable <- matrix(nrow=col_count,ncol=2,byrow=TRUE)
  colnames(returntable) <- c("Ratio_Completeness","Ratio_Outliers")
  rownames(returntable) <- colnames(df)
  # returntable <- as.table(returntable)
  
  
  for (i in 1:col_count) {
    
    # Completeness check: percentage of non-na values
    na_count <- sum(length(which(is.na(df[,i]))))
    naratio.count <- (1 - (na_count/nrow(df)) )

    
    # Free-of-error check: count of  outliers
    if ( class(df[1,i])==class(1) || class(df[1,i])==class(1.0) ) {
      IQR <- quantile(df[,i], .75, na.rm = T) - quantile(df[,i], .25, na.rm = T)
      threshold.upper <- quantile(df[,i], .75, na.rm = T) + IQR*critereon
      threshold.lower <- quantile(df[,i], .25, na.rm = T) - IQR*critereon
      outliers.index <- which(df[,i] > threshold.upper | df[,i] < threshold.lower)
      outliers.count <- length(outliers.index)/col_count
    }
    else outliers.count='not numeric'
    
    # Write check values into table:
    returntable[i,] <- matrix(c(naratio.count, outliers.count),ncol=2)
  }
  returndf <- as.data.frame(returntable)
  returndf$Ratio_Completeness <- as.numeric(returndf$Ratio_Completeness)
  
  returndf <- cbind(VAR_NAME = rownames(returndf), returndf)
  rownames(returndf) <- NULL
  
  return(returndf)
  
}
```
      
  
#### Quality check:
```{r}
ordered.df <- raw.df[,order(colnames(raw.df))]

data.quality <- qualitycheck(ordered.df)

hist(data.quality$Ratio_Completeness)
hist(suppressWarnings(as.numeric(data.quality$Ratio_Outliers)))

# data.quality[data.quality$Ratio_Completeness == 0, 1:2]
# data.quality[data.quality$Ratio_Outliers == 'not numeric', ]
```


# Data clean up
Remove all columns that are empty
```{r}
good.fields <- data.quality[data.quality$Ratio_Completeness != 0,1]
clean.df <- ordered.df[, good.fields]
qualitycheck(clean.df)
hist(qualitycheck(clean.df)$Ratio_Completeness)
```



# Total share of enrollment of undergraduate degree-seeking students who are:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Asian {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
colors = c("#4CAF50", "#4CAF50", "#4CAF50", "#4CAF50", "#4CAF50")  # in case I want differnt colors later
asians.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = colors[i],
               aes(x = longitude,
                   y = latitude,
                   size = ugds_asian)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  asians.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(asians.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(asians.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(asians.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(asians.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(asians.map[[5]][[1]]))
```    




## Hispanic {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
dotcolor = "#03A9F4"
peeps.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = dotcolor,
               aes(x = longitude,
                   y = latitude,
                   size = ugds_hisp)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  peeps.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[5]][[1]]))
```    




## Black {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
dotcolor = "#673AB7"
peeps.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = dotcolor,
               aes(x = longitude,
                   y = latitude,
                   size = ugds_black)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  peeps.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[5]][[1]]))
```    




## White {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
dotcolor = "#FF5722"
peeps.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = dotcolor,
               aes(x = longitude,
                   y = latitude,
                   size = ugds_white)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  peeps.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[5]][[1]]))
```    




## Women {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
dotcolor = "#D4E157"
peeps.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = dotcolor,
               aes(x = longitude,
                   y = latitude,
                   size = ugds_women)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  peeps.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[5]][[1]]))
```    




## Men {.tabset}
```{r, include=FALSE}
data("fifty_states")
years = c(2015, 2016, 2017, 2018, "latest")
dotcolor = "#EC407A"
peeps.map <- list()


for (i in 1:5){
  plot.temp <- suppressWarnings(
    ggplot() + geom_polygon(
    data = fifty_states,
    aes(x = long, y = lat, group = group),
    color = "white",
    fill = "grey92") +
    coord_sf(xlim = c(-88, -78),
             ylim = c(24.5, 33),
             expand = FALSE) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = dotcolor,
               aes(x = longitude,
                   y = latitude,
                   size = ugds_men)) +
    geom_point(data = clean.df[clean.df$year == years[i],],
               color = '#D4E157',
               aes(x = longitude,
                   y = latitude,
                   size = ugds_women)) +
    scale_size(name = "", range = c(.2, 3)) +
    guides(size = guide_legend("asians")) +
    theme_void())
  peeps.map[[i]] <- list(plot.temp, years[i])
}
```

### `r asians.map[[1]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[1]][[1]]))
```

### `r asians.map[[2]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[2]][[1]]))
```     

### `r asians.map[[3]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[3]][[1]]))
```    

### `r asians.map[[4]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[4]][[1]]))
```    

### `r asians.map[[5]][[2]]`
```{r, echo=FALSE}
suppressWarnings(ggplotly(peeps.map[[5]][[1]]))
```    


## AMANADS GRAPHS
###
